!function(a){var b=function(d,c){this.$element=a(d);this.options=a.extend({},a.fn.tree.defaults,c);this.$element.on("click",".tree-item",a.proxy(function(e){this.selectItem(e.currentTarget)},this));this.$element.on("click",".tree-folder-header",a.proxy(function(e){this.selectFolder(e.currentTarget)},this));this.render()};b.prototype={constructor:b,render:function(){this.populate(this.$element)},populate:function(e){var d=this;var f=e.parent();var c=f.find(".tree-loader:eq(0)");c.show();this.options.dataSource.data(e.data(),function(g){c.hide();a.each(g.data,function(h,k){var i;if(k.type==="folder"){i=d.$element.find(".tree-folder:eq(0)").clone().show();i.find(".tree-folder-name").html(k.name);i.find(".tree-loader").html(d.options.loadingHTML);i.find(".tree-folder-header").data(k)}else{if(k.type==="item"){i=d.$element.find(".tree-item:eq(0)").clone().show();i.find(".tree-item-name").html(k.name);i.data(k)}}var j=k.dataAttributes||[];a.each(j,function(l,m){switch(l){case"class":case"classes":case"className":i.addClass(m);break;default:i.attr(l,m);break}});if(e.hasClass("tree-folder-header")){f.find(".tree-folder-content:eq(0)").append(i)}else{e.append(i)}});d.$element.trigger("loaded",f)})},selectItem:function(e){var d=a(e);var g=this.$element.find(".tree-selected");var f=[];if(this.options.multiSelect){a.each(g,function(i,j){var h=a(j);if(h[0]!==d[0]){f.push(a(j).data())}})}else{if(g[0]!==d[0]){g.removeClass("tree-selected").find("i").removeClass("icon-ok").addClass("tree-dot");f.push(d.data())}}if(this.options.selectable){var c="selected";if(d.hasClass("tree-selected")){c="unselected";d.removeClass("tree-selected");d.find("i").removeClass("icon-ok").addClass("tree-dot")}else{d.addClass("tree-selected");d.find("i").removeClass("tree-dot").addClass("icon-ok");if(this.options.multiSelect){f.push(d.data())}}}if(f.length){this.$element.trigger("selected",{info:f})}d.trigger("updated",{info:f,item:d,eventType:c})},selectFolder:function(g){var e=a(g);var i=e.parent();var c=i.find(".tree-folder-content");var h=c.eq(0);var d,j,f;if(e.find(".icon-folder-close").length){d="opened";j=".icon-folder-close";f="icon-folder-open";h.show();if(!c.children().length){this.populate(e)}}else{d="closed";j=".icon-folder-open";f="icon-folder-close";h.hide();if(!this.options.cacheItems){h.empty()}}i.find(j).eq(0).removeClass("icon-folder-close icon-folder-open").addClass(f);this.$element.trigger(d,e.data())},selectedItems:function(){var d=this.$element.find(".tree-selected");var c=[];a.each(d,function(e,f){c.push(a(f).data())});return c},collapse:function(){var c=this.options.cacheItems;this.$element.find(".icon-folder-open").each(function(){var e=a(this).removeClass("icon-folder-close icon-folder-open").addClass("icon-folder-close");var d=e.parent().parent();var f=d.children(".tree-folder-content");f.hide();if(!c){f.empty()}})}};a.fn.tree=function(d,f){var e;var c=this.each(function(){var i=a(this);var h=i.data("tree");var g=typeof d==="object"&&d;if(!h){i.data("tree",(h=new b(this,g)))}if(typeof d==="string"){e=h[d](f)}});return(e===undefined)?c:e};a.fn.tree.defaults={selectable:true,multiSelect:false,loadingHTML:"<div>Loading...</div>",cacheItems:true};a.fn.tree.Constructor=b}(window.jQuery);