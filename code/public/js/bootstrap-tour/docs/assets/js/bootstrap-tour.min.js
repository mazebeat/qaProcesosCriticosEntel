(function(d,c){var b,a;a=c.document;b=(function(){function e(f){var h;try{h=c.localStorage}catch(g){h=false}this._options=d.extend({name:"tour",steps:[],container:"body",keyboard:true,storage:h,debug:false,backdrop:false,redirect:true,orphan:false,duration:false,basePath:"",template:"<div class='popover'> <div class='arrow'></div> <h3 class='popover-title'></h3> <div class='popover-content'></div> <div class='popover-navigation'> <div class='btn-group'> <button class='btn btn-sm btn-default' data-role='prev'>&laquo; Prev</button> <button class='btn btn-sm btn-default' data-role='next'>Next &raquo;</button> <button class='btn btn-sm btn-default' data-role='pause-resume' data-pause-text='Pause' data-resume-text='Resume'>Pause</button> </div> <button class='btn btn-sm btn-default' data-role='end'>End tour</button> </div> </div>",afterSetState:function(i,j){},afterGetState:function(i,j){},afterRemoveState:function(i){},onStart:function(i){},onEnd:function(i){},onShow:function(i){},onShown:function(i){},onHide:function(i){},onHidden:function(i){},onNext:function(i){},onPrev:function(i){},onPause:function(j,i){},onResume:function(j,i){}},f);this._force=false;this._inited=false;this.backdrop={overlay:null,$element:null,$background:null,backgroundShown:false,overlayElementShown:false};this}e.prototype.addSteps=function(g){var h,i,f;for(i=0,f=g.length;i<f;i++){h=g[i];this.addStep(h)}return this};e.prototype.addStep=function(f){this._options.steps.push(f);return this};e.prototype.getStep=function(f){if(this._options.steps[f]!=null){return d.extend({id:"step-"+f,path:"",placement:"right",title:"",content:"<p></p>",next:f===this._options.steps.length-1?-1:f+1,prev:f-1,animation:true,container:this._options.container,backdrop:this._options.backdrop,redirect:this._options.redirect,orphan:this._options.orphan,duration:this._options.duration,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume},this._options.steps[f])}};e.prototype.init=function(f){this._force=f;if(this.ended()){this._debug("Tour ended, init prevented.");return this}this.setCurrentStep();this._initMouseNavigation();this._initKeyboardNavigation();this._onResize((function(g){return function(){return g.showStep(g._current)}})(this));if(this._current!==null){this.showStep(this._current)}this._inited=true;return this};e.prototype.start=function(f){var g;if(f==null){f=false}if(!this._inited){this.init(f)}if(this._current===null){g=this._makePromise(this._options.onStart!=null?this._options.onStart(this):void 0);this._callOnPromiseDone(g,this.showStep,0)}return this};e.prototype.next=function(){var f;f=this.hideStep(this._current);return this._callOnPromiseDone(f,this._showNextStep)};e.prototype.prev=function(){var f;f=this.hideStep(this._current);return this._callOnPromiseDone(f,this._showPrevStep)};e.prototype.goTo=function(f){var g;g=this.hideStep(this._current);return this._callOnPromiseDone(g,this.showStep,f)};e.prototype.end=function(){var f,g;f=(function(h){return function(i){d(a).off("click.tour-"+h._options.name);d(a).off("keyup.tour-"+h._options.name);d(c).off("resize.tour-"+h._options.name);h._setState("end","yes");h._inited=false;h._force=false;h._clearTimer();if(h._options.onEnd!=null){return h._options.onEnd(h)}}})(this);g=this.hideStep(this._current);return this._callOnPromiseDone(g,f)};e.prototype.ended=function(){return !this._force&&!!this._getState("end")};e.prototype.restart=function(){this._removeState("current_step");this._removeState("end");return this.start()};e.prototype.pause=function(){var f;f=this.getStep(this._current);if(!(f&&f.duration)){return this}this._paused=true;this._duration-=new Date().getTime()-this._start;c.clearTimeout(this._timer);this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining).");if(f.onPause!=null){return f.onPause(this,this._duration)}};e.prototype.resume=function(){var f;f=this.getStep(this._current);if(!(f&&f.duration)){return this}this._paused=false;this._start=new Date().getTime();this._duration=this._duration||f.duration;this._timer=c.setTimeout((function(g){return function(){if(g._isLast()){return g.next()}else{return g.end()}}})(this),this._duration);this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration);if((f.onResume!=null)&&this._duration!==f.duration){return f.onResume(this,this._duration)}};e.prototype.hideStep=function(g){var f,j,h;h=this.getStep(g);if(!h){return}this._clearTimer();j=this._makePromise(h.onHide!=null?h.onHide(this,g):void 0);f=(function(i){return function(l){var k;k=d(h.element);if(!(k.data("bs.popover")||k.data("popover"))){k=d("body")}k.popover("destroy").removeClass("tour-"+i._options.name+"-element tour-"+i._options.name+"-"+g+"-element");if(h.reflex){k.css("cursor","").off("click.tour-"+i._options.name)}if(h.backdrop){i._hideBackdrop()}if(h.onHidden!=null){return h.onHidden(i)}}})(this);this._callOnPromiseDone(j,f);return j};e.prototype.showStep=function(f){var k,j,h,g;if(this.ended()){this._debug("Tour ended, showStep prevented.");return this}g=this.getStep(f);if(!g){return}h=f<this._current;k=this._makePromise(g.onShow!=null?g.onShow(this,f):void 0);j=(function(i){return function(m){var n,l;i.setCurrentStep(f);l=(function(){switch({}.toString.call(g.path)){case"[object Function]":return g.path();case"[object String]":return this._options.basePath+g.path;default:return g.path}}).call(i);n=[a.location.pathname,a.location.hash].join("");if(i._isRedirect(l,n)){i._redirect(g,l);return}if(i._isOrphan(g)){if(!g.orphan){i._debug("Skip the orphan step "+(i._current+1)+". Orphan option is false and the element doesn't exist or is hidden.");if(h){i._showPrevStep()}else{i._showNextStep()}return}i._debug("Show the orphan step "+(i._current+1)+". Orphans option is true.")}if(g.backdrop){i._showBackdrop(!i._isOrphan(g)?g.element:void 0)}i._scrollIntoView(g.element,function(){if(i.getCurrentStep()!==f){return}if((g.element!=null)&&g.backdrop){i._showOverlayElement(g.element)}i._showPopover(g,f);if(g.onShown!=null){g.onShown(i)}return i._debug("Step "+(i._current+1)+" of "+i._options.steps.length)});if(g.duration){return i.resume()}}})(this);this._callOnPromiseDone(k,j);return k};e.prototype.getCurrentStep=function(){return this._current};e.prototype.setCurrentStep=function(f){if(f!=null){this._current=f;this._setState("current_step",f)}else{this._current=this._getState("current_step");this._current=this._current===null?null:parseInt(this._current,10)}return this};e.prototype._setState=function(f,h){var i,g;if(this._options.storage){g=""+this._options.name+"_"+f;try{this._options.storage.setItem(g,h)}catch(j){i=j;if(i.code===DOMException.QUOTA_EXCEEDED_ERR){this.debug("LocalStorage quota exceeded. State storage failed.")}}return this._options.afterSetState(g,h)}else{if(this._state==null){this._state={}}return this._state[f]=h}};e.prototype._removeState=function(f){var g;if(this._options.storage){g=""+this._options.name+"_"+f;this._options.storage.removeItem(g);return this._options.afterRemoveState(g)}else{if(this._state!=null){return delete this._state[f]}}};e.prototype._getState=function(f){var g,h;if(this._options.storage){g=""+this._options.name+"_"+f;h=this._options.storage.getItem(g)}else{if(this._state!=null){h=this._state[f]}}if(h===void 0||h==="null"){h=null}this._options.afterGetState(f,h);return h};e.prototype._showNextStep=function(){var h,f,g;g=this.getStep(this._current);f=(function(i){return function(j){return i.showStep(g.next)}})(this);h=this._makePromise(g.onNext!=null?g.onNext(this):void 0);return this._callOnPromiseDone(h,f)};e.prototype._showPrevStep=function(){var h,f,g;g=this.getStep(this._current);f=(function(i){return function(j){return i.showStep(g.prev)}})(this);h=this._makePromise(g.onPrev!=null?g.onPrev(this):void 0);return this._callOnPromiseDone(h,f)};e.prototype._debug=function(f){if(this._options.debug){return c.console.log("Bootstrap Tour '"+this._options.name+"' | "+f)}};e.prototype._isRedirect=function(g,f){return(g!=null)&&g!==""&&(({}.toString.call(g)==="[object RegExp]"&&!g.test(f))||({}.toString.call(g)==="[object String]"&&g.replace(/\?.*$/,"").replace(/\/?$/,"")!==f.replace(/\/?$/,"")))};e.prototype._redirect=function(f,g){if(d.isFunction(f.redirect)){return f.redirect.call(this,g)}else{if(f.redirect===true){this._debug("Redirect to "+g);return a.location.href=g}}};e.prototype._isOrphan=function(f){return(f.element==null)||!d(f.element).length||d(f.element).is(":hidden")&&(d(f.element)[0].namespaceURI!=="http://www.w3.org/2000/svg")};e.prototype._isLast=function(){return this._current<this._options.steps.length-1};e.prototype._showPopover=function(l,k){var f,n,j,m,g,h;d(".tour-"+this._options.name).remove();h=d.extend({},this._options);j=d.isFunction(l.template)?d(l.template(k,l)):d(l.template);n=j.find(".popover-navigation");g=this._isOrphan(l);if(g){l.element="body";l.placement="top";j=j.addClass("orphan")}f=d(l.element);j.addClass("tour-"+this._options.name+" tour-"+this._options.name+"-"+k);f.addClass("tour-"+this._options.name+"-element tour-"+this._options.name+"-"+k+"-element");if(l.options){d.extend(h,l.options)}if(l.reflex&&!g){f.css("cursor","pointer").on("click.tour-"+this._options.name,(function(i){return function(){if(i._isLast()){return i.next()}else{return i.end()}}})(this))}if(l.prev<0){n.find("[data-role='prev']").addClass("disabled")}if(l.next<0){n.find("[data-role='next']").addClass("disabled")}if(!l.duration){n.find("[data-role='pause-resume']").remove()}l.template=j.clone().wrap("<div>").parent().html();f.popover({placement:l.placement,trigger:"manual",title:l.title,content:l.content,html:true,animation:l.animation,container:l.container,template:l.template,selector:l.element}).popover("show");m=f.data("bs.popover")?f.data("bs.popover").tip():f.data("popover").tip();m.attr("id",l.id);this._reposition(m,l);if(g){return this._center(m)}};e.prototype._reposition=function(j,g){var h,f,i,m,n,l,k;m=j[0].offsetWidth;f=j[0].offsetHeight;k=j.offset();n=k.left;l=k.top;h=d(a).outerHeight()-k.top-j.outerHeight();if(h<0){k.top=k.top+h}i=d("html").outerWidth()-k.left-j.outerWidth();if(i<0){k.left=k.left+i}if(k.top<0){k.top=0}if(k.left<0){k.left=0}j.offset(k);if(g.placement==="bottom"||g.placement==="top"){if(n!==k.left){return this._replaceArrow(j,(k.left-n)*2,m,"left")}}else{if(l!==k.top){return this._replaceArrow(j,(k.top-l)*2,f,"top")}}};e.prototype._center=function(f){return f.css("top",d(c).outerHeight()/2-f.outerHeight()/2)};e.prototype._replaceArrow=function(h,i,g,f){return h.find(".arrow").css(f,i?50*(1-i/g)+"%":"")};e.prototype._scrollIntoView=function(h,m){var g,k,f,i,j,l;g=d(h);if(!g.length){return m()}k=d(c);i=g.offset().top;l=k.height();j=Math.max(0,i-(l/2));this._debug("Scroll into view. ScrollTop: "+j+". Element offset: "+i+". Window height: "+l+".");f=0;return d("body,html").stop(true,true).animate({scrollTop:Math.ceil(j)},(function(n){return function(){if(++f===2){m();return n._debug("Scroll into view. Animation end element offset: "+(g.offset().top)+". Window height: "+(k.height())+".")}}})(this))};e.prototype._onResize=function(g,f){return d(c).on("resize.tour-"+this._options.name,function(){clearTimeout(f);return f=setTimeout(g,100)})};e.prototype._initMouseNavigation=function(){var f;f=this;return d(a).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']").off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='next']:not(.disabled)",(function(g){return function(h){h.preventDefault();return g.next()}})(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='prev']:not(.disabled)",(function(g){return function(h){h.preventDefault();return g.prev()}})(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='end']",(function(g){return function(h){h.preventDefault();return g.end()}})(this)).on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role='pause-resume']",function(h){var g;h.preventDefault();g=d(this);g.text(f._paused?g.data("pause-text"):g.data("resume-text"));if(f._paused){return f.resume()}else{return f.pause()}})};e.prototype._initKeyboardNavigation=function(){if(!this._options.keyboard){return}return d(a).on("keyup.tour-"+this._options.name,(function(f){return function(g){if(!g.which){return}switch(g.which){case 39:g.preventDefault();if(f._isLast()){return f.next()}else{return f.end()}break;case 37:g.preventDefault();if(f._current>0){return f.prev()}break;case 27:g.preventDefault();return f.end()}}})(this))};e.prototype._makePromise=function(f){if(f&&d.isFunction(f.then)){return f}else{return null}};e.prototype._callOnPromiseDone=function(h,g,f){if(h){return h.then((function(i){return function(j){return g.call(i,f)}})(this))}else{return g.call(this,f)}};e.prototype._showBackdrop=function(f){if(this.backdrop.backgroundShown){return}this.backdrop=d("<div/>",{"class":"tour-backdrop"});this.backdrop.backgroundShown=true;return d("body").append(this.backdrop)};e.prototype._hideBackdrop=function(){this._hideOverlayElement();return this._hideBackground()};e.prototype._hideBackground=function(){if(this.backdrop){this.backdrop.remove();this.backdrop.overlay=null;return this.backdrop.backgroundShown=false}};e.prototype._showOverlayElement=function(h){var g,f,i;f=d(h);if(!f||f.length===0||this.backdrop.overlayElementShown){return}this.backdrop.overlayElementShown=true;g=d("<div/>");i=f.offset();i.top=i.top;i.left=i.left;g.width(f.innerWidth()).height(f.innerHeight()).addClass("tour-step-background").offset(i);f.addClass("tour-step-backdrop");d("body").append(g);this.backdrop.$element=f;return this.backdrop.$background=g};e.prototype._hideOverlayElement=function(){if(!this.backdrop.overlayElementShown){return}this.backdrop.$element.removeClass("tour-step-backdrop");this.backdrop.$background.remove();this.backdrop.$element=null;this.backdrop.$background=null;return this.backdrop.overlayElementShown=false};e.prototype._clearTimer=function(){c.clearTimeout(this._timer);this._timer=null;return this._duration=null};return e})();return c.Tour=b})(jQuery,window);